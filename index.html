<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>thehiflyer/Fettle @ GitHub</title>

  <style type="text/css">
    body {
      margin-top: 1.0em;
      background-color: #cfddca;
      font-family: "Helvetica,Arial,FreeSans",serif;
      color: #000000;
    }
    #container {
      margin: 0 auto;
      width: 1000px;
    }
    h1 { font-size: 3.8em; color: #302235; margin-bottom: 3px; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #302235; }
    h3 { color: #302235; }
    a { color: #302235; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
  </style>
	<script type="text/javascript" src="js/shCore.js"></script>
	<script type="text/javascript" src="js/shBrushJava.js"></script>
	<link href="css/shCore.css" rel="stylesheet" type="text/css" />
	<link href="css/shCoreRDark.css" rel="stylesheet" type="text/css" />

	<!--<link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />-->
</head>

<body>
  <a href="http://github.com/thehiflyer/Fettle"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

  <div id="container">

    <div class="download">
		 <a href="https://github.com/downloads/thehiflyer/Fettle/fettle-0.8.0.jar">
        <img border="0" width="90" src="jar.png"></a>
      <a href="http://github.com/thehiflyer/Fettle/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/thehiflyer/Fettle/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="http://github.com/thehiflyer/Fettle">Fettle</a>
      <span class="small">by <a href="http://github.com/thehiflyer">thehiflyer</a></span></h1>

    <div class="description">
      A state machine framework for java
    </div>

    <p>Fettle is an attempt to write a well tested solid simple framework for statemachines in java. I have tried to keep it easy to use, type safe and still flexible.</p>
	
	<h2>User guide</h2>
	<p>Fettle uses a template called a transition model that describes the transitions and actions for a state machine. Using this model, thin state machine instances can be created</p>
	<h3>Creating a builder</h3>
	 <pre class="brush: java">
// Create a state machine with the enum States as state space and strings as events
StateMachineBuilder&lt;States, String, Void&gt; builder = Fettle.newBuilder(States.class, String.class);
</pre>
	  <p>
		  To create a new state machine you can either make a builder object or just create a transition model.<br/>
		  Using the builder is recommended since the transition model is more intended for internal use and is quite verbose and not as readable.
	  </p>

	  <h3>Adding transitions</h3>
	<pre class="brush: java">
// Addding a transition from INITIAL to ONE when the event "foo" is fired
builder.transition().from(States.INITIAL).to(States.ONE).on("foo");
</pre>
	  <p>
		  In order to add states to the state machine we have to add transitions since isolated states makes no sense from Fettles points of view. States are added to the transition model as they are encountered in transitions. A transition always has to take place on an event.
	  </p>


	  <h3>Conditional transitions</h3>
	<pre class="brush: java">
Condition&lt;Arguments&gt; firstArgIsOne = new Condition&lt;Arguments&gt;() {
	@Override
	public boolean isSatisfied(Arguments args) {
		return args.getNumberOfArguments() &gt; 0 && args.getFirst().equals(1);
	}
};

Condition&lt;Arguments&gt; noArguments = new Condition&lt;Arguments&gt;() {
	@Override
	public boolean isSatisfied(Arguments args) {
		return args.getNumberOfArguments() == 0;
	}
};

builder.transition().from(States.INITIAL).to(States.ONE).on("tick").when(BasicConditions.or(firstArgIsOne, noArguments));

// The above setup will make this pass
StateMachine&lt;States, String, Arguments&gt; stateMachine = builder.build(States.INITIAL);
stateMachine.fireEvent("tick", new Arguments(3));
assertEquals(States.INITIAL, stateMachine.getCurrentState());

stateMachine.fireEvent("tick", Arguments.NO_ARGS);
assertEquals(States.ONE, stateMachine.getCurrentState());
</pre>
	  <p>
		  Conditions can be added to transitions to prevent them from being performed unless the condition is fulfilled. Conditions can be compounded using and, or, not and xor in BasicConditions.
	  </p>
<h3>Transition actions</h3>
<pre class="brush: java">
Action&lt;States, String, Void&gt; action1 = new Action&lt;States, String, Void&gt;() {
	@Override
	public void onTransition(States from, States to, String causedBy, Void ignored, StateMachine&lt;States, String&gt; statesStringStateMachine) {
		// do whatever is desired
	}
};
Action&lt;States, String, Void&gt; action2 = new Action&lt;States, String, Void&gt;() {
	@Override
	public void onTransition(States from, States to, String causedBy, Void ignored, StateMachine&lt;States, String&gt; statesStringStateMachine) {
		// do whatever is desired
	}
};
List&lt;Action&lt;States, String, Void&gt;&gt; actions = GuavaReplacement.newArrayList();
actions.add(action1);
actions.add(action2);
builder.transition().from(States.INITIAL).to(States.ONE).on("foo").perform(actions);</pre>
The actions action1 and action2 will be performed (in the listed order) during the transition from state INITIAL to state ONE.
<h3>Entry & exit actions</h3>
<pre class="brush: java">
Action&lt;States, String, Void&gt; action1 = new Action&lt;States, String, Void&gt;() {
	@Override
	public void onTransition(States from, States to, String causedBy, Void ignored, StateMachine&lt;States, String&gt; statesStringStateMachine) {
		// do whatever is desired
	}
};
Action&lt;States, String, Void&gt; action2 = new Action&lt;States, String, Void&gt;() {
	@Override
	public void onTransition(States from, States to, String causedBy, Void ignored, StateMachine&lt;States, String&gt; statesStringStateMachine) {
		// do whatever is desired
	}
};
builder.onExit(States.INITIAL).perform(action1);
builder.onEntry(States.ONE).perform(action2);
</pre>
Whenever the state INITIAL is left, the action1 will be performed and whenever the state ONE is entered, the action2 will be performed.

<h3>Creating a state machine</h3>
<pre class="brush: java">
StateMachineBuilder&lt;States,String, ContextClass&gt; builder = Fettle.newBuilder(States.class, String.class);

// Configure state transitions and actions

StateMachineTemplate&lt;States, String, ContextClass&gt; stateMachineTemplate = builder.buildTransitionModel();
StateMachine&lt;States, String, ContextClass&gt; stateMachine1 = stateMachineTemplate.newStateMachine(States.INITIAL);
StateMachine&lt;States, String, ContextClass&gt; stateMachine2 = stateMachineTemplate.newStateMachine(States.INITIAL);
</pre>
Both state machines are flyweight objects and will share the transition model, i.e. the definition on what transitions are made on what events but they can change state independently.
This makes it very cheap to have many state machines using the same transition rules.<br/>
If only one state machine is required, there is a short hand way to create a state machine directly.
<pre class="brush: java">
StateMachine&lt;States, String, ContextClass&gt; stateMachine = builder.build(States.INITIAL);
</pre>
<h3>Fire events</h3>
<pre class="brush: java">
StateMachineBuilder&lt;States,String, Arguments&gt; builder = Fettle.newBuilder(States.class, String.class);
// Setup transitions

// This changes the default context (passed when fireEvent is called without context) from null to Arguments.NO_ARGS
builder.defaultContext(Arguments.NO_ARGS);

StateMachine&lt;States, String, Arguments&gt; stateMachine = builder.build(States.INITIAL);


stateMachine.fireEvent("foo");
stateMachine.fireEvent("foo", new Arguments("bar"));
stateMachine.fireEvent("foo", new Arguments("bar", 1, 2));
</pre>
<h2>Dependencies</h2>
<p><strong>Runtime:</strong><br/>
<a href="http://code.google.com/p/guava-libraries/">Guava</a> (Only if you want to use the PredicateCondition, otherwise there are no runtime dependencies)
</p>
	  <p>
<strong>Build time:</strong><br/>

<a href="http://www.junit.org/">JUnit</a><br/>
<a href="http://code.google.com/p/mockachino/">Mockachino</a><br/>
<a href="http://code.google.com/p/guava-libraries/">Guava</a>
</p>
All libs are managed by gradle
<h2>Install</h2>
<p>Fettle is using <a href="http://gradle.org">Gradle</a> to build</p>
<p><strong>To build:</strong><br/>
gradle build<br/>
<strong>To build a jar:</strong><br/>
gradle jar</p>
<p>
There is a gradle wrapper checked in so that you can build without installing gradle on your machine. Gradle is however awesome so you should really get it :)<br/>
./gradlew build  (on *nix)<br/>
gradlew.bat build (on windows)
</p>
<h2>Fettle Users</h2>
<ul>
	<li><img src="solitaire.png"/> <a href="https://apps.facebook.com/pyramidsolitairesaga/">Pyramid Solitaire Saga</a> by <a href="http://king.com"> King.com</a></li>
	<li><a href="http://tuer.sourceforge.net/very_experimental/tuer.jnlp">TUER</a> by Julien Gouesse</li>
</ul>

<h2>Authors</h2>
<p>thehiflyer aka hiflyer (per.malmen@gmail.com)
<br/>
<br/>      </p>
<h2>Contact</h2>
<p> (per.malmen@gmail.com)
<br/>      </p>


    <h2>Download</h2>
    <p>
      You can download this project in either
      <a href="http://github.com/thehiflyer/Fettle/zipball/master">zip</a> or
      <a href="http://github.com/thehiflyer/Fettle/tarball/master">tar</a> formats.
		</p>
	  <p>
		  If you don't need the source,
		 just download the jar of the latest version&nbsp;<a href="https://github.com/downloads/thehiflyer/Fettle/fettle-0.8.0.jar">fettle-0.8.0.jar</a><br/>
		  or if you're in a GWT project <a href="https://github.com/downloads/thehiflyer/Fettle/fettle-0.8.0-gwt.jar">fettle-0.8.0-gwt.jar</a>
    </p>
    <p>You can also clone the project with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>$ git clone git://github.com/thehiflyer/Fettle</pre>
    </p>
	 <p>
		 Fettle is now uploaded to <a href="http://search.maven.org/#browse%7C222743246">Sonatypes maven repository</a>
	 </p>
	  <h2>License</h2>
	  <p>Fettle is licensed under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a></p>

    <div class="footer">
      get the source code on GitHub : <a href="http://github.com/thehiflyer/Fettle">thehiflyer/Fettle</a>
    </div>

  </div>

  <script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-12038900-3");
pageTracker._trackPageview();
} catch(err) {}</script>
  <script type="text/javascript">
	  SyntaxHighlighter.all()
  </script>
</body>
</html>
